{"version":3,"sources":["../../src/util/watch.util.js"],"names":["watch","mkdirsSync","dirname","mode","existsSync","mkdirSync","delDirs","path","files","readdirSync","forEach","file","index","curPath","statSync","isDirectory","unlinkSync","rmdirSync","appName","runtimeName","callback","watcher","ignored","persistent","ignoreInitial","on","filePath","stats","fileRuntimePath","replace","runtimePath","dirPath","dirRuntimePath"],"mappings":";;;;;kBAiCwBA,K;;AAjCxB;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,SAASC,UAAT,CAAoBC,OAApB,EAA6BC,IAA7B,EAAmC;AAC/B,QAAI,aAAGC,UAAH,CAAcF,OAAd,CAAJ,EAA4B;AACxB,eAAO,IAAP;AACH,KAFD,MAEO;AACH,YAAID,WAAW,eAAKC,OAAL,CAAaA,OAAb,CAAX,EAAkCC,IAAlC,CAAJ,EAA6C;AACzC,yBAAGE,SAAH,CAAaH,OAAb,EAAsBC,IAAtB;AACA,mBAAO,IAAP;AACH;AACJ;AACJ;;AAED,SAASG,OAAT,CAAiBC,IAAjB,EAAuB;AACnB,QAAIC,QAAQ,EAAZ;AACA,QAAI,aAAGJ,UAAH,CAAcG,IAAd,CAAJ,EAAyB;AACrBC,gBAAQ,aAAGC,WAAH,CAAeF,IAAf,CAAR;AACAC,cAAME,OAAN,CAAc,UAAUC,IAAV,EAAgBC,KAAhB,EAAuB;AACjC,gBAAIC,UAAUN,OAAO,GAAP,GAAaI,IAA3B;AACA,gBAAI,aAAGG,QAAH,CAAYD,OAAZ,EAAqBE,WAArB,EAAJ,EAAwC;AAAE;AACtCT,wBAAQO,OAAR;AACH,aAFD,MAEO;AAAE;AACL,6BAAGG,UAAH,CAAcH,OAAd;AACH;AACJ,SAPD;AAQA,qBAAGI,SAAH,CAAaV,IAAb;AACH;AACJ;;AAEc,SAASP,KAAT,CAAekB,OAAf,EAAwBC,WAAxB,EAAqCC,QAArC,EAA+C;;AAE1D,QAAMC,UAAU,mBAASrB,KAAT,CAAekB,OAAf,EAAwB;AACpCI,iBAAS,UAD2B;AAEpCC,oBAAY,IAFwB;AAGpCC,uBAAe;AAHqB,KAAxB,CAAhB;;AAMAH,YAAQI,EAAR,CAAW,KAAX,EAAkB,UAAUC,QAAV,EAAoBC,KAApB,EAA2B;;AAEzC,YAAMC,kBAAkBF,SAASG,OAAT,MAAoBX,OAApB,OAAkCC,WAAlC,CAAxB;AACAlB,mBAAW,eAAKC,OAAL,CAAa0B,eAAb,CAAX;;AAEA,wBAAMF,QAAN,EAAgB,KAAhB;AACAN,iBAASM,QAAT;AACH,KAPD;;AASAL,YAAQI,EAAR,CAAW,QAAX,EAAqB,UAAUC,QAAV,EAAoBC,KAApB,EAA2B;;AAE5C,wBAAMD,QAAN,EAAgB,QAAhB;AACAN,iBAASM,QAAT;AACH,KAJD;;AAMAL,YAAQI,EAAR,CAAW,QAAX,EAAqB,UAAUC,QAAV,EAAoBC,KAApB,EAA2B;;AAE5C,YAAMG,cAAcJ,SAASG,OAAT,MAAoBX,OAApB,OAAkCC,WAAlC,CAApB;AACA,qBAAGH,UAAH,CAAcc,WAAd;;AAEA,wBAAMJ,QAAN,EAAgB,QAAhB;AACAN,iBAASM,QAAT,EAAmB,KAAnB;AACH,KAPD;;AASAL,YAAQI,EAAR,CAAW,WAAX,EAAwB,UAAUM,OAAV,EAAmB;;AAEvC,YAAMC,iBAAiBD,QAAQF,OAAR,MAAmBX,OAAnB,OAAiCC,WAAjC,CAAvB;AACAb,gBAAQ0B,cAAR;AACH,KAJD;AAKH","file":"watch.util.js","sourcesContent":["import chokidar from \"chokidar\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport {watch as debug} from \"./../util/log.util\";\nimport config from \"./../config/index.config\";\n\nfunction mkdirsSync(dirname, mode) {\n    if (fs.existsSync(dirname)) {\n        return true;\n    } else {\n        if (mkdirsSync(path.dirname(dirname), mode)) {\n            fs.mkdirSync(dirname, mode);\n            return true;\n        }\n    }\n}\n\nfunction delDirs(path) {\n    let files = [];\n    if (fs.existsSync(path)) {\n        files = fs.readdirSync(path);\n        files.forEach(function (file, index) {\n            let curPath = path + \"/\" + file;\n            if (fs.statSync(curPath).isDirectory()) { // recurse\n                delDirs(curPath);\n            } else { // delete file\n                fs.unlinkSync(curPath);\n            }\n        });\n        fs.rmdirSync(path);\n    }\n};\n\nexport default function watch(appName, runtimeName, callback) {\n\n    const watcher = chokidar.watch(appName, {\n        ignored: /[\\/\\\\]\\./,\n        persistent: true,\n        ignoreInitial: true\n    });\n\n    watcher.on('add', function (filePath, stats) {\n\n        const fileRuntimePath = filePath.replace(`${appName}`, `${runtimeName}`);\n        mkdirsSync(path.dirname(fileRuntimePath));\n\n        debug(filePath, 'add');\n        callback(filePath);\n    });\n\n    watcher.on('change', function (filePath, stats) {\n\n        debug(filePath, 'change');\n        callback(filePath);\n    });\n\n    watcher.on('unlink', function (filePath, stats) {\n\n        const runtimePath = filePath.replace(`${appName}`, `${runtimeName}`);\n        fs.unlinkSync(runtimePath);\n\n        debug(filePath, 'unlink');\n        callback(filePath, false);\n    });\n\n    watcher.on('unlinkDir', function (dirPath) {\n\n        const dirRuntimePath = dirPath.replace(`${appName}`, `${runtimeName}`);\n        delDirs(dirRuntimePath);\n    });\n}"]}